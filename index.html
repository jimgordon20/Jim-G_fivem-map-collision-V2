<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Jim-G FiveM Collision Finder</title><link rel="icon" href="./jim_g_logo_v3.png" type="image/png"><script src="https://cdn.tailwindcss.com"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/spark-md5/3.0.2/spark-md5.min.js"></script><style>body{ background-color: #050505; color: #e2e8f0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-image: radial-gradient(circle at 50% 0%, #111 0%, #050505 70%); overflow-y: scroll; } .scrollbar-hide::-webkit-scrollbar{ display: none;} .scrollbar-hide{ -ms-overflow-style: none; scrollbar-width: none;} .glass-panel{ background: rgba(10, 10, 10, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.03); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);} .glass-header{ background: rgba(5, 5, 5, 0.85); backdrop-filter: blur(16px); border-bottom: 1px solid rgba(255, 255, 255, 0.03);} .custom-checkbox:checked{ background-color: #10b981; border-color: #10b981;} .btn-primary{ background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); transition: all 0.3s ease;} .btn-primary:hover{ box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); transform: translateY(-1px);} .btn-accent{ background: linear-gradient(135deg, #10b981 0%, #059669 100%); transition: all 0.3s ease;} .btn-accent:hover{ box-shadow: 0 0 20px rgba(16, 185, 129, 0.4); transform: translateY(-1px);} .logo-glow{ filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.3));} .animate-pulse-slow{ animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;} @keyframes pulse{ 0%, 100%{ opacity: 1;} 50%{ opacity: .5;}} </style></head><body class="min-h-screen flex flex-col"><header class="glass-header sticky top-0 z-50"><div class="w-full px-8 py-2 flex justify-between items-center"><div class="flex items-center space-x-4"><div class="relative group"><img src="./jim_g_logo_v3.png" alt="Jim-G Logo" class="h-20 w-auto logo-glow transition-transform duration-300 group-hover:scale-105"></div><div class="border-l border-zinc-800 pl-4 hidden sm:block"><h1 class="text-2xl font-bold text-white tracking-tight flex items-center gap-2">Jim-G FiveM Collision Finder <span class="text-[10px] font-bold tracking-wider uppercase text-emerald-400 bg-emerald-900/20 px-2 py-0.5 rounded border border-emerald-500/20">v4</span></h1><p class="text-xs text-zinc-500 font-medium tracking-wide uppercase">FiveM Map Optimization Tool</p></div></div><div class="flex items-center gap-3"><a href="https://discord.gg/6QUTHVA3VP" target="_blank" class="group flex items-center gap-2 px-4 py-2 rounded-full bg-[#5865F2]/10 hover:bg-[#5865F2]/30 transition-all border border-[#5865F2]/20 hover:border-[#5865F2]/40"><svg class="h-5 w-5 text-[#5865F2] group-hover:text-white transition-colors" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0857 2.1568 2.419 0 1.3332-.946 2.419-2.1568 2.419zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0857 2.1568 2.419 0 1.3332-.946 2.419-2.1568 2.419z"/></svg><span class="text-sm font-medium text-[#5865F2] group-hover:text-white hidden md:inline">Discord</span></a><a href="https://jim-g.tebex.io/" target="_blank" class="group flex items-center gap-2 px-4 py-2 rounded-full bg-amber-500/10 hover:bg-amber-500/30 transition-all border border-amber-500/20 hover:border-amber-500/40"><svg class="h-5 w-5 text-amber-500 group-hover:text-white transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg><span class="text-sm font-medium text-amber-500 group-hover:text-white hidden md:inline">Store</span></a><a href="https://github.com/jimgordon20" target="_blank" class="group flex items-center gap-2 px-4 py-2 rounded-full bg-zinc-800/50 hover:bg-zinc-700/50 transition-all border border-zinc-700 hover:border-zinc-600"><svg class="h-5 w-5 text-zinc-400 group-hover:text-white transition-colors" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg><span class="text-sm font-medium text-zinc-300 group-hover:text-white hidden md:inline">GitHub</span></a></div></div></header><main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 w-full flex flex-col justify-center"><div id="setup-panel" class="w-full max-w-3xl mx-auto"><div id="drop-zone" class="glass-panel rounded-2xl p-8 shadow-2xl text-center space-y-6 transition-all duration-300"><div class="inline-flex items-center justify-center p-6 bg-slate-800/50 rounded-full mb-6 border border-slate-700 shadow-lg relative group"><div class="absolute inset-0 bg-blue-500/20 rounded-full blur-xl group-hover:bg-blue-500/30 transition-all duration-500"></div><svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-blue-400 relative z-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" /></svg></div><h2 class="text-4xl font-bold text-white tracking-tight">Select Resources Folder</h2><p class="text-slate-400 max-w-lg mx-auto text-lg leading-relaxed">Select your FiveM server's <code class="bg-slate-800/80 px-2 py-1 rounded text-emerald-400 font-mono border border-slate-700">resources</code>folder to scan for map collisions and duplicates. </p><div class="bg-amber-500/10 border border-amber-500/20 rounded-xl p-5 max-w-xl mx-auto text-left flex gap-4 backdrop-blur-sm"><div class="bg-amber-500/20 p-2 rounded-lg h-fit"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div><div><h4 class="text-amber-300 font-bold text-sm uppercase tracking-wide mb-1">Browser Permission</h4><p class="text-sm text-amber-100/80 leading-relaxed">Your browser will ask for permission to "View files". Please click <strong>"View files"</strong>or <strong>"Allow"</strong>. This runs entirely on your computer—no data is uploaded. </p></div></div><div class="pt-6"><button id="select-folder-btn" class="btn-primary text-white font-bold py-4 px-10 rounded-xl shadow-2xl shadow-blue-900/50 flex items-center gap-3 mx-auto text-lg group"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 group-hover:scale-110 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z" /></svg>Select Resources Folder or Drag & Drop </button><p class="text-xs text-slate-500 mt-4 font-medium uppercase tracking-wide"></p></div></div></div><div id="config-panel" class="hidden w-full max-w-5xl mx-auto glass-panel rounded-2xl p-8 shadow-2xl relative overflow-hidden mt-8"><div class="absolute top-0 right-0 w-64 h-64 bg-emerald-500/5 rounded-full blur-3xl -mr-32 -mt-32 pointer-events-none"></div><div class="flex items-center justify-between mb-6"><h3 class="text-2xl font-bold text-white flex items-center gap-3"><div class="bg-slate-800 p-2 rounded-lg border border-slate-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg></div>Scan Configuration </h3><div class="text-xs font-mono text-slate-500 bg-slate-900/50 px-3 py-1 rounded border border-slate-800">TARGET: <span class="text-emerald-400">RESOURCES</span></div></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div><div class="mt-8 flex justify-end border-t border-slate-700/50 pt-6"><button id="start-scan-btn" class="btn-accent text-white font-bold py-3 px-8 rounded-xl shadow-lg flex items-center gap-2 text-lg group"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 group-hover:rotate-180 transition-transform duration-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>Start Scan </button></div></div><div id="progress-panel" class="hidden w-full max-w-3xl mx-auto mt-12"><div class="glass-panel rounded-2xl p-8 shadow-2xl relative overflow-hidden"><div class="absolute -top-24 -right-24 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl pointer-events-none"></div><div class="absolute -bottom-24 -left-24 w-64 h-64 bg-emerald-500/10 rounded-full blur-3xl pointer-events-none"></div><div class="text-center mb-8"><h3 class="text-3xl font-bold text-white mb-2 tracking-tight">System Scan in Progress</h3><p class="text-red-400 text-sm font-medium mt-2 max-w-lg mx-auto">If it looks like the UI has frozen please be patient, this may take a little while to start the search if your directory is big.</p><div class="flex justify-center items-center gap-4 mt-6"><div id="phase-1" class="flex items-center gap-2 text-slate-500 transition-colors duration-300"><div class="w-2 h-2 rounded-full bg-current"></div><span class="text-xs font-bold uppercase tracking-wider">Discovery</span></div><div class="w-8 h-px bg-slate-800"></div><div id="phase-2" class="flex items-center gap-2 text-slate-500 transition-colors duration-300"><div class="w-2 h-2 rounded-full bg-current"></div><span class="text-xs font-bold uppercase tracking-wider">Hashing</span></div><div class="w-8 h-px bg-slate-800"></div><div id="phase-3" class="flex items-center gap-2 text-slate-500 transition-colors duration-300"><div class="w-2 h-2 rounded-full bg-current"></div><span class="text-xs font-bold uppercase tracking-wider">Analysis</span></div></div></div><div class="flex flex-col md:flex-row items-center justify-center gap-8 mb-8"><div class="relative w-32 h-32 flex items-center justify-center"><svg class="w-full h-full transform -rotate-90"><circle cx="64" cy="64" r="60" stroke="currentColor" stroke-width="8" fill="transparent" class="text-slate-800" /><circle id="progress-circle" cx="64" cy="64" r="60" stroke="currentColor" stroke-width="8" fill="transparent" stroke-dasharray="377" stroke-dashoffset="377" class="text-blue-500 transition-all duration-300 ease-out" /></svg><div class="absolute inset-0 flex items-center justify-center flex-col"><span id="progress-percent" class="text-3xl font-bold text-white">0%</span></div></div><div class="grid grid-cols-2 gap-4 w-full md:w-auto min-w-[200px]"><div class="bg-slate-800/40 p-4 rounded-xl border border-white/5"><span class="text-xs text-slate-500 uppercase tracking-wider block mb-1">Files Found</span><div id="stats-files" class="text-2xl font-mono text-emerald-400 font-bold">0</div></div><div class="bg-slate-800/40 p-4 rounded-xl border border-white/5"><span class="text-xs text-slate-500 uppercase tracking-wider block mb-1">Status</span><div id="progress-text" class="text-sm font-medium text-blue-300 h-8 flex items-center">Initializing...</div></div><div class="bg-slate-800/40 p-4 rounded-xl border border-white/5"><span class="text-xs text-slate-500 uppercase tracking-wider block mb-1">Speed</span><div id="speed-files" class="text-lg font-mono text-white font-bold">0 <span class="text-xs text-slate-500 font-normal">files/s</span></div></div><div class="bg-slate-800/40 p-4 rounded-xl border border-white/5"><span class="text-xs text-slate-500 uppercase tracking-wider block mb-1">Throughput</span><div id="speed-data" class="text-lg font-mono text-white font-bold">0 <span class="text-xs text-slate-500 font-normal">MB/s</span></div></div></div></div><div class="bg-black/30 rounded-lg p-3 border border-white/5 relative overflow-hidden group"><div class="absolute inset-0 bg-blue-500/5 group-hover:bg-blue-500/10 transition-colors"></div><div class="flex items-center gap-3 relative z-10"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg><div class="flex-1 min-w-0"><div class="text-[10px] text-slate-500 uppercase tracking-wider mb-0.5">Processing File</div><div id="stats-current" class="text-xs text-slate-300 font-mono truncate h-4 leading-4">Waiting to start...</div></div></div></div></div></div><div id="results-panel" class="hidden w-full max-w-5xl mx-auto mt-8 pb-20"><div class="glass-panel rounded-2xl p-8 mb-8 relative overflow-hidden"><div class="absolute -top-24 -right-24 w-64 h-64 bg-emerald-500/10 rounded-full blur-3xl pointer-events-none"></div><div class="absolute -bottom-24 -left-24 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl pointer-events-none"></div><div class="flex flex-col md:flex-row items-center justify-between gap-6 relative z-10"><div><h2 class="text-3xl font-bold text-white mb-2">Scan Complete</h2><p class="text-slate-400">Here is what we found in your resources.</p></div><div class="flex gap-4"><div class="text-center px-6 py-3 bg-red-500/10 border border-red-500/20 rounded-xl"><div id="result-conflicts-count" class="text-3xl font-bold text-red-400">0</div><div class="text-xs text-red-300 uppercase tracking-wider">Conflicts</div></div><div class="text-center px-6 py-3 bg-yellow-500/10 border border-yellow-500/20 rounded-xl"><div id="result-duplicates-count" class="text-3xl font-bold text-yellow-400">0</div><div class="text-xs text-yellow-300 uppercase tracking-wider">Duplicates</div></div></div></div><div class="mt-8 flex flex-wrap gap-4 pt-6 border-t border-white/5"><button onclick="downloadReport('html')" class="flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors border border-white/5"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>Download HTML Report </button><button onclick="downloadReport('lua')" class="flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors border border-white/5"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>Download LUA Script </button><button onclick="location.reload()" class="ml-auto flex items-center gap-2 px-4 py-2 text-slate-400 hover:text-white transition-colors"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>New Scan </button></div></div><div id="storage-treemap-container" class="glass-panel rounded-2xl p-6 mb-8 hidden"><h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4" /></svg>Storage Visualization </h3><div class="w-full h-12 bg-slate-800/50 rounded-lg overflow-hidden flex shadow-inner" id="storage-treemap"></div><div id="treemap-legend" class="mt-4 flex flex-wrap gap-3 text-xs text-slate-400"></div></div><div id="results-container" class="space-y-6"></div></div></main><footer class="border-t border-zinc-900 bg-[#050505] py-4 mt-auto"><div class="max-w-7xl mx-auto px-4 text-center text-zinc-600 text-sm"><p>&copy; 2025 Jim-G. All rights reserved.</p><p class="mt-1">Built for the FiveM Community.</p></div></footer><script>// Global Error Handler for debugging window.onerror=function(msg, url, lineNo, columnNo, error){ console.error('Global Error:', msg, url, lineNo, error); // Ignore extension errors and tailwind warnings in UI if (url && url.includes('chrome-extension')) return; if (msg.includes('tailwindcss')) return;}; // Configuration Constants const ALL_MAP_RELATED_FILES={ "*.ymap":{ desc: "Map Data (Placement/Details)", recommended: true}, "light_ymaps":{ desc: "Light Map Files (lodlights*.ymap / vw_*.ymap)", recommended: true}, "*.ybn":{ desc: "Bounds/Collision Data", recommended: true}, "*.ymt":{ desc: "Meta/Config Files", recommended: false}, "*.ytd":{ desc: "Textures Dictionary", recommended: false}, "*.ydr":{ desc: "Drawable (3D Models)", recommended: false}, "*.ydd":{ desc: "Drawable Dictionary", recommended: false}, "*.ytyp":{ desc: "Types/Manifest", recommended: false}, "*.ycd":{ desc: "Clip Dictionary", recommended: false}, "*.ynv":{ desc: "Navigation Mesh", recommended: false}, "*.ypt":{ desc: "Particle Effects", recommended: false}}; // State let directoryHandle=null; let scanConfig={}; let fileList=[]; let lastScanPatterns=[]; // Store for reports let results={ conflicts:{}, duplicates:{}}; // Elements const setupPanel=document.getElementById('setup-panel'); const configPanel=document.getElementById('config-panel'); const progressPanel=document.getElementById('progress-panel'); const resultsPanel=document.getElementById('results-panel'); const configGrid=configPanel.querySelector('.grid'); // Initialize UI function init(){ // Check Browser Support if (!window.showDirectoryPicker){ const btn=document.getElementById('select-folder-btn'); btn.classList.remove('btn-primary'); btn.classList.add('bg-red-600', 'hover:bg-red-700', 'cursor-not-allowed'); btn.innerHTML=` <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>Browser Not Supported `; btn.disabled=true; const msg=document.createElement('p'); msg.className="text-red-400 mt-4 font-bold"; msg.innerText="This tool requires Google Chrome, Edge, or Opera (Desktop). Firefox/Safari are not supported due to missing File System APIs."; document.getElementById('drop-zone').appendChild(msg); return;} // Generate Config Toggles for (const [pattern, info] of Object.entries(ALL_MAP_RELATED_FILES)){ // Clean up display name: remove * and . and replace _ with space let displayName=pattern.replace(/\*/g, '').replace(/\./g, ''); if (displayName==='light_ymaps') displayName='light ymaps'; const id=`check-${pattern.replace(/\*/g, '').replace(/\./g, '')}`; const div=document.createElement('div'); div.className='flex items-center justify-between p-4 rounded-xl bg-slate-800/40 hover:bg-slate-800/60 transition-colors border border-white/5 hover:border-white/10 group'; div.innerHTML=` <div class="flex-1 mr-4"><label for="${id}" class="font-bold text-white block cursor-pointer select-none group-hover:text-blue-400 transition-colors uppercase">${displayName}</label><p class="text-slate-400 text-xs mt-1">${info.desc}</p></div><label class="relative inline-flex items-center cursor-pointer"><input id="${id}" type="checkbox" value="${pattern}" class="sr-only peer" ${info.recommended ? 'checked' : ''}><div class="w-11 h-6 bg-slate-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"></div></label>`; configGrid.appendChild(div);}} // --- Core Logic: File System Access & Scanning --- // 1. Select Directory document.getElementById('select-folder-btn').addEventListener('click', async ()=>{ console.log("Select Folder Button Clicked"); if (!window.showDirectoryPicker){ alert("Your browser does not support the File System Access API. Please use Google Chrome or Microsoft Edge."); return;} try{ console.log("Requesting Directory Handle..."); directoryHandle=await window.showDirectoryPicker({ mode: 'read'}); console.log("Directory Handle Received:", directoryHandle); // Transition to Config Page setupPanel.classList.add('hidden'); configPanel.classList.remove('hidden');} catch (err){ console.error(err); if (err.name !=='AbortError'){ alert("Error accessing folder: " + err.message + "\n\nMake sure you are using a supported browser (Chrome/Edge) and serving via HTTPS (or localhost).");}}}); // 2. Start Scan document.getElementById('start-scan-btn').addEventListener('click', async ()=>{ // Get Config const checkboxes=configGrid.querySelectorAll('input[type="checkbox"]'); const patterns=[]; checkboxes.forEach(cb=>{ if (cb.checked) patterns.push(cb.value);}); if (patterns.length===0){ alert("Please select at least one file type to scan."); return;} // Switch Views configPanel.classList.add('hidden'); progressPanel.classList.remove('hidden'); // Start Processing lastScanPatterns=patterns; await runScan(patterns);}); // 3. Recursive Scanner async function runScan(patterns){ fileList=[]; // Elements const progressCircle=document.getElementById('progress-circle'); const progressPercent=document.getElementById('progress-percent'); const progressText=document.getElementById('progress-text'); const statsFiles=document.getElementById('stats-files'); const statsCurrent=document.getElementById('stats-current'); // Phase Elements const p1=document.getElementById('phase-1'); const p2=document.getElementById('phase-2'); const p3=document.getElementById('phase-3'); // Reset UI progressCircle.style.strokeDashoffset=377; // 0% progressPercent.innerText="0%"; statsFiles.innerText="0"; // Helper to update Phase UI const setPhase=(phase)=>{ // Reset all [p1, p2, p3].forEach(el=>{ el.classList.remove('text-blue-400', 'text-emerald-400', 'animate-pulse'); el.classList.add('text-slate-500');}); if (phase===1){ p1.classList.remove('text-slate-500'); p1.classList.add('text-blue-400', 'animate-pulse');} else if (phase===2){ p1.classList.remove('text-slate-500'); p1.classList.add('text-emerald-400'); // Completed p2.classList.remove('text-slate-500'); p2.classList.add('text-blue-400', 'animate-pulse');} else if (phase===3){ p1.classList.remove('text-slate-500'); p1.classList.add('text-emerald-400'); p2.classList.remove('text-slate-500'); p2.classList.add('text-emerald-400'); p3.classList.remove('text-slate-500'); p3.classList.add('text-blue-400', 'animate-pulse');}}; // --- Phase 1: File Discovery --- setPhase(1); progressText.innerText="Scanning directories..."; statsCurrent.innerText="Searching..."; try{ await scanDirectory(directoryHandle, patterns, "");} catch (err){ alert("Error scanning directory: " + err.message); console.error(err); location.reload(); return;} statsFiles.innerText=fileList.length; if (fileList.length===0){ alert("No matching files found!"); location.reload(); return;} // --- Phase 2: Hashing --- setPhase(2); progressText.innerText="Computing MD5 hashes..."; const fileInfoDict={}; //{ "filename.ext": [{ path, hash, resource}, ... ]} let processed=0; let totalBytesProcessed=0; const startTime=performance.now(); let lastUpdate=0; const total=fileList.length; const circumference=377; for (const fileData of fileList){ statsCurrent.innerText=fileData.name; try{ const file=await fileData.handle.getFile(); totalBytesProcessed +=file.size; const hash=await computeMD5(file); const key=fileData.name.toLowerCase(); if (!fileInfoDict[key]) fileInfoDict[key]=[]; fileInfoDict[key].push({ path: fileData.path, resource: fileData.resource, hash: hash, size: file.size, lastModified: file.lastModified});} catch (e){ console.warn("Could not read file:", fileData.path, e);} processed++; const pct=Math.round((processed / total) * 100); // Update Stats (throttled) const now=performance.now(); if (now - lastUpdate >200 || processed===total){ lastUpdate=now; const elapsed=(now - startTime) / 1000; if (elapsed >0){ const filesPerSec=Math.round(processed / elapsed); const mbPerSec=(totalBytesProcessed / 1024 / 1024 / elapsed).toFixed(1); document.getElementById('speed-files').innerHTML=`${filesPerSec} <span class="text-xs text-slate-500 font-normal">files/s</span>`; document.getElementById('speed-data').innerHTML=`${mbPerSec} <span class="text-xs text-slate-500 font-normal">MB/s</span>`;} // Update Circle const offset=circumference - (processed / total) * circumference; progressCircle.style.strokeDashoffset=offset; progressPercent.innerText=`${pct}%`;}} // --- Phase 3: Analysis --- setPhase(3); progressText.innerText="Analyzing conflicts..."; // Small delay to let user see 100% await new Promise(r=>setTimeout(r, 500)); analyzeResults(fileInfoDict); renderStorageTreeMap(fileInfoDict); // Generate TreeMap displayResults();} async function scanDirectory(dirHandle, patterns, pathPrefix){ // patterns logic helpers const matchers=patterns.map(p=>{ if (p==='light_ymaps') return{ type: 'light'}; // Simple glob to regex conversion for * const regex=new RegExp('^' + p.replace(/\./g, '\\.').replace(/\*/g, '.*') + '$', 'i'); return{ type: 'glob', regex: regex};}); for await (const entry of dirHandle.values()){ const relativePath=pathPrefix ? `${pathPrefix}/${entry.name}` : entry.name; if (entry.kind==='directory'){ // Recurse await scanDirectory(entry, patterns, relativePath);} else{ // File Check const nameLower=entry.name.toLowerCase(); let matched=false; let isLightMap=(nameLower.startsWith('lodlights') || nameLower.startsWith('vw_')) && nameLower.endsWith('.ymap'); for (const m of matchers){ if (m.type==='light'){ if (isLightMap){ matched=true; break;}} else{ if (m.regex.test(nameLower)){ // Exclude lightmaps from standard *.ymap wildcard if light_ymaps is NOT selected? // The logic in python was: if *.ymap selected, include lights unless explicitly excluded. // Here we keep it simple: if it matches a pattern, we take it. // BUT we should respect the "ignore light maps" if the user didn't check it? // For simplicity in web v4: If you check *.ymap, you get all ymaps. // If you want to filter logic strictly like Python v2, we can refine. matched=true; break;}}} if (matched){ // Determine Resource Name (First folder in path) const parts=relativePath.split('/'); const resource=parts.length >1 ? parts[0] : "ROOT"; fileList.push({ name: entry.name, path: relativePath, handle: entry, resource: resource}); // Update stats immediately for live feedback document.getElementById('stats-files').innerText=fileList.length;}}}} function computeMD5(file){ return new Promise((resolve, reject)=>{ const reader=new FileReader(); const spark=new SparkMD5.ArrayBuffer(); // Chunk size: 2MB const chunkSize=2097152; const chunks=Math.ceil(file.size / chunkSize); let currentChunk=0; reader.onload=function(e){ spark.append(e.target.result); currentChunk++; if (currentChunk < chunks){ loadNext();} else{ resolve(spark.end());}}; reader.onerror=function(){ reject("Read error");}; function loadNext(){ const start=currentChunk * chunkSize; const end=((start + chunkSize) >=file.size) ? file.size : start + chunkSize; reader.readAsArrayBuffer(file.slice(start, end));} loadNext();});} function analyzeResults(fileInfoDict){ // Group by extension const categorized={}; let totalConflicts=0; let totalDuplicates=0; for (const [filename, files] of Object.entries(fileInfoDict)){ if (files.length < 2) continue; const ext=filename.split('.').pop().toUpperCase(); if (!categorized[ext]) categorized[ext]={ conflicts: [], duplicates: []}; // Check hashes const uniqueHashes=new Set(files.map(f=>f.hash)); if (uniqueHashes.size >1){ // Conflict categorized[ext].conflicts.push({ filename, files}); totalConflicts +=uniqueHashes.size; // Count variants? Or just files? Python did unique hashes} else{ // Duplicate categorized[ext].duplicates.push({ filename, files}); totalDuplicates++;}} results=categorized; document.getElementById('result-conflicts-count').innerText=totalConflicts; document.getElementById('result-duplicates-count').innerText=totalDuplicates;} function displayResults(){ progressPanel.classList.add('hidden'); resultsPanel.classList.remove('hidden'); const container=document.getElementById('results-container'); container.innerHTML=''; const sortedExts=Object.keys(results).sort(); if (sortedExts.length===0){ container.innerHTML=` <div class="text-center py-12 text-slate-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg><h3 class="text-xl font-medium text-white">Clean Scan!</h3><p>No collisions or duplicates found.</p></div>`; return;} // Inject Summary and Search Bar (Sticky Header) if (!document.getElementById('results-sticky-header')){ const stickyContainer=document.createElement('div'); stickyContainer.id='results-sticky-header'; stickyContainer.className="sticky top-[96px] z-40 space-y-4 mb-6"; // Stick below main header // 1. Summary Header (Moved here) const summaryHeader=resultsPanel.querySelector('.glass-panel'); // The existing summary if (summaryHeader){ summaryHeader.classList.remove('mb-8'); // Remove old margin summaryHeader.classList.add('shadow-2xl', 'border-b', 'border-white/10'); // Add extra shadow/border for separation stickyContainer.appendChild(summaryHeader);} // 2. Search Bar const searchBar=document.createElement('div'); searchBar.className="glass-panel p-2 rounded-xl flex items-center gap-3 px-4 shadow-lg"; searchBar.innerHTML=` <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg><input type="text" id="results-search-bar" placeholder="Search files, resources, or paths..." class="bg-transparent border-none focus:ring-0 text-white w-full placeholder-slate-500 h-10 outline-none" onkeyup="filterResults(this.value)">`; stickyContainer.appendChild(searchBar); resultsPanel.prepend(stickyContainer);} for (const ext of sortedExts){ const data=results[ext]; if (data.conflicts.length===0 && data.duplicates.length===0) continue; const sectionId=`section-${ext.replace(/[^a-zA-Z0-9]/g, '')}`; // Get description safely let desc="Unknown File Type"; const patternKey=`*${ext.toLowerCase()}`; if (ALL_MAP_RELATED_FILES[patternKey]){ desc=ALL_MAP_RELATED_FILES[patternKey].desc;} else if (ext==='LIGHT YMAPS'){ desc=ALL_MAP_RELATED_FILES['light_ymaps'].desc;} const isExpanded=true; const section=document.createElement('div'); section.className='glass-panel rounded-xl overflow-hidden transition-all duration-300 result-section mb-6 border border-white/5'; // Removed glass-panel default background if needed, but keeping for container structure section.setAttribute('data-ext', ext); let html=` <div class="bg-black/40 px-6 py-4 border-b border-white/5 cursor-pointer hover:bg-black/60 transition-colors flex items-center justify-between group select-none backdrop-blur-md" onclick="toggleSection('${sectionId}')"><div class="flex items-center gap-4"><div class="bg-blue-500/10 p-2 rounded-lg border border-blue-500/20 group-hover:border-blue-500/40 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg></div><div><h3 class="text-lg font-bold text-white flex items-center gap-2">.${ext} Files </h3><div class="flex gap-3 text-xs font-mono mt-1">${data.conflicts.length >0 ? `<span class="text-red-400 font-bold bg-red-500/10 px-2 py-0.5 rounded border border-red-500/20">${data.conflicts.length} Conflicts</span>` : ''} ${data.duplicates.length >0 ? `<span class="text-yellow-400 font-bold bg-yellow-500/10 px-2 py-0.5 rounded border border-yellow-500/20">${data.duplicates.length} Duplicates</span>` : ''} </div></div></div><svg id="chevron-${sectionId}" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500 transform transition-transform duration-300 ${isExpanded ? 'rotate-180' : ''}" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg></div><div id="${sectionId}" class="${isExpanded ? '' : 'hidden'} bg-black/20">`; // Conflicts if (data.conflicts.length >0){ html +=`<div class="p-6"><div class="mb-4 flex items-center gap-2 text-red-400 font-bold uppercase text-sm tracking-wide"><div class="w-2 h-2 rounded-full bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.5)]"></div>Critical Conflicts <span class="text-slate-500 text-xs normal-case ml-2 font-normal">(Files with same name but different content)</span></div><div class="space-y-4">`; data.conflicts.forEach(item=>{ html +=createResultItemHTML(item.filename, item.files, 'red');}); html +=`</div></div>`;} // Duplicates if (data.duplicates.length >0){ html +=`<div class="p-6 border-t border-slate-700/50"><div class="mb-4 flex items-center gap-2 text-yellow-400 font-bold uppercase text-sm tracking-wide"><div class="w-2 h-2 rounded-full bg-yellow-500 shadow-[0_0_10px_rgba(234,179,8,0.5)]"></div>Redundant Duplicates <span class="text-slate-500 text-xs normal-case ml-2 font-normal">(Identical files in multiple locations)</span></div><div class="space-y-4">`; data.duplicates.forEach(item=>{ html +=createResultItemHTML(item.filename, item.files, 'yellow');}); html +=`</div></div>`;} html +=`</div>`; // Close accordion body section.innerHTML=html; container.appendChild(section);}} function createResultItemHTML(filename, files, color){ const colorClass=color==='red' ? 'border-red-500/30 bg-red-500/5' : 'border-yellow-500/30 bg-yellow-500/5'; const headerColor=color==='red' ? 'text-red-200' : 'text-yellow-200'; let rows=''; files.forEach(f=>{ const safePath=f.path.replace(/\\/g, '\\\\').replace(/'/g, "\\'"); const sizeStr=formatBytes(f.size); const dateStr=formatDate(f.lastModified); rows +=` <tr class="border-b border-white/5 hover:bg-white/5 transition-colors group/row"><td class="py-3 pl-4 pr-2"><div class="font-medium text-white">${f.resource}</div></td><td class="py-3 px-2"><div class="text-slate-400 text-xs truncate max-w-[200px] md:max-w-[300px] xl:max-w-[500px]" title="${f.path}">${f.path}</div></td><td class="py-3 px-2 text-right"><div class="font-mono text-xs text-slate-500 whitespace-nowrap">${sizeStr}</div></td><td class="py-3 px-2 text-right"><div class="font-mono text-xs text-slate-500 whitespace-nowrap">${dateStr}</div></td><td class="py-3 pl-2 pr-4 text-right"><button onclick="copyToClipboard('${safePath}')" class="text-xs bg-slate-700 hover:bg-blue-600 text-white px-2 py-1.5 rounded transition-colors inline-flex items-center gap-1 opacity-0 group-hover/row:opacity-100 focus:opacity-100"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" /></svg>Copy </button></td></tr>`;}); return ` <div class="border rounded-lg ${colorClass} result-card overflow-hidden"><div class="px-4 py-2 bg-black/20 border-b border-white/5 flex items-center justify-between"><div class="font-mono text-sm font-bold ${headerColor} break-all flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>${filename} </div></div><div class="w-full overflow-x-auto"><table class="w-full text-left text-sm border-collapse"><thead><tr class="text-xs font-semibold text-slate-500 uppercase tracking-wider bg-black/10"><th class="py-2 pl-4 pr-2 w-1/4">Resource</th><th class="py-2 px-2 w-1/3">Path</th><th class="py-2 px-2 text-right">Size</th><th class="py-2 px-2 text-right">Modified</th><th class="py-2 pl-2 pr-4 text-right w-20">Action</th></tr></thead><tbody>${rows} </tbody></table></div></div>`;} // Helpers function formatBytes(bytes, decimals=2){ if (!+bytes) return '0 B'; const k=1024; const dm=decimals < 0 ? 0 : decimals; const sizes=['B', 'KB', 'MB', 'GB', 'TB']; const i=Math.floor(Math.log(bytes) / Math.log(k)); return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;} function formatDate(timestamp){ if (!timestamp) return 'N/A'; return new Date(timestamp).toLocaleDateString(undefined,{ year: 'numeric', month: 'short', day: 'numeric'});} function toggleSection(id){ const el=document.getElementById(id); const chevron=document.getElementById(`chevron-${id}`); if (el) el.classList.toggle('hidden'); if (chevron) chevron.classList.toggle('rotate-180');} function filterResults(query){ const term=query.toLowerCase(); const cards=document.querySelectorAll('.result-card'); cards.forEach(card=>{ const text=card.innerText.toLowerCase(); if (text.includes(term)){ card.classList.remove('hidden');} else{ card.classList.add('hidden');}}); const sections=document.querySelectorAll('.result-section'); sections.forEach(sec=>{ const visibleCards=sec.querySelectorAll('.result-card:not(.hidden)'); if (visibleCards.length===0){ sec.classList.add('hidden');} else{ sec.classList.remove('hidden');}});} // Global Copy Helper window.copyToClipboard=function(text){ const lastSlash=text.lastIndexOf('/'); const dir=lastSlash >-1 ? text.substring(0, lastSlash) : text; const winDir=dir.replace(/\//g, '\\'); navigator.clipboard.writeText(winDir).then(()=>{ alert("Copied directory to clipboard:\n" + winDir);}).catch(err=>{ console.error('Copy failed', err);});}; // --- Report Generation & Download --- window.downloadReport=function(format){ if (!results || Object.keys(results).length===0){ alert("No results to download!"); return;} const timestamp=new Date().toISOString().replace(/T/, ' ').replace(/\..+/, ''); const dirName=directoryHandle ? directoryHandle.name : "Unknown Directory"; // Calculate totals again for the report let totalConflicts=0; let totalDuplicates=0; for (const ext in results){ if (results[ext].conflicts){ for (const k in results[ext].conflicts){ // In Python logic, it counted unique hashes >1. // Here our structure is{ filename: [{path, hash},{path, hash} ]} // The 'results' object is grouped by extension:{ EXT:{ conflicts: [{filename, files} ], duplicates: []}} // Wait, my analyzeResults function structured it as: // categorized[ext]={ conflicts: [{filename, files} ], duplicates: [{filename, files} ]} // So I can just count the array lengths? // Actually, Python code counted 'uniqueHashes.size' for conflicts. // My JS analyzeResults loop: // if (uniqueHashes.size >1){ categorized[ext].conflicts.push(...)} // So categorized[ext].conflicts is a list of conflicting filenames. // Python 'total_conflicts' +=len(unique_hashes). // Let's just pass the 'results' object which is 'categorized' to the generators.}}} // Just let the generators handle counting/displaying. let content=""; let filename=`collision_report_${Date.now()}`; let mimeType="text/plain"; if (format==='html'){ content=generateHTMLReport(results, dirName, lastScanPatterns, timestamp); filename +=".html"; mimeType="text/html";} else{ content=generateLuaReport(results, dirName, lastScanPatterns, timestamp); filename +=".lua";} downloadFile(filename, content, mimeType);}; function downloadFile(filename, content, mimeType){ const blob=new Blob([content],{ type: mimeType}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=filename; document.body.appendChild(a); a.click(); setTimeout(()=>{ document.body.removeChild(a); window.URL.revokeObjectURL(url);}, 0);} function generateLuaReport(results, dirName, patterns, timestamp){ let lines=[]; lines.push('-- ###################################################'); lines.push('-- # JIM-G FIVEM MAP COLLISION REPORT (LUA) #'); lines.push('-- ###################################################'); lines.push(`-- Scan Time: ${timestamp}`); lines.push(`-- Target Directory: ${dirName}`); lines.push(`-- File Patterns Searched: ${patterns.join(', ')}`); lines.push('-- ###################################################\n'); const separator="--############################################################################################################################################################################################################################################################--"; let isFirst=true; // Calculate totals for summary at end let totalConflicts=0; let totalDuplicates=0; const sortedExts=Object.keys(results).sort(); for (const ext of sortedExts){ const data=results[ext]; if (data.conflicts.length===0 && data.duplicates.length===0) continue; if (!isFirst) lines.push(separator); isFirst=false; lines.push(`-- --- ${ext} Collisions ---`); if (data.conflicts.length >0){ lines.push(" -- [CRITICAL CONFLICTS] (Same Name, Different Content)"); data.conflicts.forEach(item=>{ // Count for summary (approximate, simply counting conflicting filenames) totalConflicts++; lines.push(` -- - File: ${item.filename}`); item.files.forEach(f=>{ lines.push(` - Resource: ${f.resource.padEnd(25)} Path: ${f.path}`);});});} if (data.duplicates.length >0){ lines.push(" -- [Redundant Duplicates] (Same Name, Identical Content)"); data.duplicates.forEach(item=>{ totalDuplicates++; lines.push(` -- - File: ${item.filename}`); item.files.forEach(f=>{ lines.push(` - Resource: ${f.resource.padEnd(25)} Path: ${f.path}`);});});}} lines.push('\n-- --- Final Summary ---'); lines.push(`-- Total Critical Conflicts Found: ${totalConflicts}`); lines.push(`-- Total Redundant Duplicates Found: ${totalDuplicates}`); lines.push('-- ###################################################'); return lines.join('\n');} function generateHTMLReport(results, dirName, patterns, timestamp){ // Count totals let totalConflicts=0; let totalDuplicates=0; const sortedExts=Object.keys(results).sort(); // Build Main Content let reportContent=""; let checkboxId=0; sortedExts.forEach(ext=>{ const data=results[ext]; if (data.conflicts.length===0 && data.duplicates.length===0) return; reportContent +=`<h3>--- ${ext} Collisions ---</h3>`; if (data.conflicts.length >0){ totalConflicts +=data.conflicts.length; reportContent +=`<div class="conflict-type">CRITICAL CONFLICTS (Same Name, Different Content)</div>`; reportContent +=`<table><tr><th class="resolution-status">Status</th><th>Colliding File</th><th>Resource</th><th>Full Path</th><th>Copy Path</th></tr>`; data.conflicts.forEach(item=>{ let isFirst=true; checkboxId++; const cbName=`conflict_${checkboxId}`; item.files.forEach(f=>{ const safePath=f.path.replace(/\\/g, '/').replace(/'/g, "\\'"); reportContent +=` <tr><td class="resolution-status">${isFirst ? `<input type="checkbox" id="${cbName}" class="resolution-box"><label for="${cbName}"></label>` : ''} </td><td style="font-weight: bold;">${isFirst ? item.filename : ''}</td><td>${f.resource}</td><td>${f.path}</td><td><button class="copy-btn" onclick="copyPathToClipboard('${safePath}')">Copy Dir</button></td></tr>`; isFirst=false;});}); reportContent +=`</table>`;} if (data.duplicates.length >0){ totalDuplicates +=data.duplicates.length; reportContent +=`<div class="duplicate-type">REDUNDANT DUPLICATES (Same Name, Identical Content)</div>`; reportContent +=`<table><tr><th class="resolution-status">Status</th><th>Duplicate File</th><th>Resource</th><th>Full Path</th><th>Copy Path</th></tr>`; data.duplicates.forEach(item=>{ let isFirst=true; checkboxId++; const cbName=`duplicate_${checkboxId}`; item.files.forEach(f=>{ const safePath=f.path.replace(/\\/g, '/').replace(/'/g, "\\'"); reportContent +=` <tr><td class="resolution-status">${isFirst ? `<input type="checkbox" id="${cbName}" class="resolution-box"><label for="${cbName}"></label>` : ''} </td><td style="font-weight: bold;">${isFirst ? item.filename : ''}</td><td>${f.resource}</td><td>${f.path}</td><td><button class="copy-btn" onclick="copyPathToClipboard('${safePath}')">Copy Dir</button></td></tr>`; isFirst=false;});}); reportContent +=`</table>`;}}); if (reportContent===""){ reportContent="<p>No collisions or duplicates found! ✨</p>";} return `<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Jim-G FiveM Map Collision Report</title><style>body{ font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background-color: #1e1e1e; color: #d4d4d4; padding-bottom: 50px;} .container{ max-width: 1800px; margin: 20px auto; padding: 0 40px;} .header{ background-color: #252526; color: #4ec9b0; padding: 40px 50px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);} .header h1{ margin: 0; font-size: 2.4em;} .header p{ margin: 5px 0; font-size: 0.95em;} .summary{ display: flex; justify-content: space-around; background-color: #333333; padding: 20px; border-radius: 8px; margin-bottom: 40px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);} .summary div{ padding: 0 20px; text-align: center;} .conflict-count{ font-size: 1.8em; font-weight: bold; color: #f44747;} .duplicate-count{ font-size: 1.8em; font-weight: bold; color: #ffeb95;} h2{ border-bottom: 2px solid #3c3c3c; padding-bottom: 10px; margin-top: 50px; color: #569cd6; font-size: 2.0em;} h3{ color: #dcdcaa; margin-top: 35px; font-size: 1.5em;} .report-section{ background-color: #2d2d30; padding: 30px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4); margin-bottom: 40px;} table{ width: 100%; border-collapse: separate; border-spacing: 0 10px; margin-top: 20px;} th, td{ padding: 22px; text-align: left; border: none; word-break: break-word; font-size: 1.1em;} th{ background-color: #3c3c3c; color: #d4d4d4; font-weight: 600; text-transform: uppercase;} tr{ background-color: #252526; transition: background-color 0.2s;} tr:hover{ background-color: #3a3a3d;} .conflict-type{ background-color: #3a1a1a; border-left: 5px solid #f44747; padding: 15px; margin-top: 20px; margin-bottom: 20px; font-weight: bold; color: #f44747; border-radius: 4px;} .duplicate-type{ background-color: #3a3a1a; border-left: 5px solid #ffeb95; padding: 15px; margin-top: 20px; margin-bottom: 20px; font-weight: bold; color: #ffeb95; border-radius: 4px;} .resolution-status{ text-align: center; width: 60px;} .resolution-box{ display: none;} .resolution-status label{ display: inline-block; width: 24px; height: 24px; text-align: center; line-height: 24px; border-radius: 4px; cursor: pointer; font-size: 1.2em; font-weight: bold; transition: all 0.1s ease-in-out; background-color: #3c3c3c;} .resolution-box + label::before{ content: '✗'; color: #f44747;} .resolution-box:checked + label::before{ content: '✓'; color: #4ec9b0;} .resolution-box:focus + label{ box-shadow: 0 0 0 2px #007acc;} .copy-btn{ background-color: #569cd6; color: white; border: none; padding: 8px 12px; text-align: center; text-decoration: none; display: inline-block; font-size: 0.9em; margin: 4px 2px; cursor: pointer; border-radius: 4px; transition: background-color 0.3s ease;} .copy-btn:hover{ background-color: #4c8cd2;} </style></head><body><div class="container"><div class="header"><h1>Jim-G FiveM Map Collision Report</h1><p>Scan Time: ${timestamp}</p><p>Target Directory: ${dirName}</p><p>File Patterns Searched: ${patterns.join(', ')}</p></div><div class="summary"><div>Total Critical Conflicts: <span class="conflict-count">${totalConflicts}</span></div><div>Total Redundant Duplicates: <span class="duplicate-count">${totalDuplicates}</span></div></div><div class="report-section"><h2>Detailed Report</h2>${reportContent} </div></div><script>function copyPathToClipboard(fullPath){ const lastSeparatorIndex=fullPath.lastIndexOf('/'); let directoryPath=fullPath.substring(0, lastSeparatorIndex + 1); directoryPath=directoryPath.replace(/\\//g, '\\\\'); navigator.clipboard.writeText(directoryPath).then(()=>{ alert('Copied directory path to clipboard: ' + directoryPath);}).catch(err=>{ console.error('Could not copy text: ', err);});} <\/script></body></html>`;} function setupDragAndDrop(){ const dropZone=document.getElementById('drop-zone'); ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName=>{ dropZone.addEventListener(eventName, preventDefaults, false);}); function preventDefaults(e){ e.preventDefault(); e.stopPropagation();} ['dragenter', 'dragover'].forEach(eventName=>{ dropZone.addEventListener(eventName, highlight, false);}); ['dragleave', 'drop'].forEach(eventName=>{ dropZone.addEventListener(eventName, unhighlight, false);}); function highlight(e){ dropZone.classList.add('border-2', 'border-blue-500', 'border-dashed', 'bg-slate-800/80');} function unhighlight(e){ dropZone.classList.remove('border-2', 'border-blue-500', 'border-dashed', 'bg-slate-800/80');} dropZone.addEventListener('drop', async (e)=>{ console.log("File Dropped"); const dt=e.dataTransfer; // Modern API (FileSystemHandle) if (dt.items && dt.items.length >0){ const item=dt.items[0]; // webkitGetAsEntry is Chrome/Edge specific, getAsEntry is standard but less supported const entry=item.webkitGetAsEntry ? item.webkitGetAsEntry() : (item.getAsEntry ? item.getAsEntry() : null); if (entry && entry.isDirectory){ try{ // Chrome/Edge support getAsFileSystemHandle if (item.getAsFileSystemHandle){ directoryHandle=await item.getAsFileSystemHandle();} else{ // Fallback for browsers that have webkitGetAsEntry but not FileSystemAccess (unlikely combo for this specific use case, but safety first) alert("Your browser supports Drag & Drop but not the modern File System Access API required for scanning large directories.\n\nPlease use Google Chrome or Microsoft Edge."); return;} setupPanel.classList.add('hidden'); configPanel.classList.remove('hidden'); return;} catch (err){ console.error("Drop Error:", err);}}} alert("Please drop a valid folder.");});} function renderStorageTreeMap(fileInfoDict){ const container=document.getElementById('storage-treemap'); const wrapper=document.getElementById('storage-treemap-container'); const legend=document.getElementById('treemap-legend'); container.innerHTML=''; legend.innerHTML=''; const resourceSizes={}; let totalSize=0; for (const key in fileInfoDict){ fileInfoDict[key].forEach(file=>{ const res=file.resource; if (!resourceSizes[res]) resourceSizes[res]=0; resourceSizes[res] +=file.size; totalSize +=file.size;});} if (totalSize===0) return; // Sort resources by size const sortedResources=Object.entries(resourceSizes) .sort((a, b)=>b[1] - a[1]); wrapper.classList.remove('hidden'); // Take top 8 resources, group rest as "Other" let topResources=sortedResources.slice(0, 8); const otherResources=sortedResources.slice(8); if (otherResources.length >0){ const otherSize=otherResources.reduce((acc, curr)=>acc + curr[1], 0); topResources.push(['Others', otherSize]);} // Colors const colors=[ 'bg-blue-500', 'bg-emerald-500', 'bg-purple-500', 'bg-amber-500', 'bg-pink-500', 'bg-cyan-500', 'bg-indigo-500', 'bg-rose-500', 'bg-slate-600' ]; topResources.forEach((item, index)=>{ const [name, size]=item; const percentage=(size / totalSize) * 100; if (percentage < 1) return; // Skip tiny blocks const colorClass=name==='Others' ? 'bg-slate-600' : colors[index % colors.length]; // Bar Block const block=document.createElement('div'); block.className=`${colorClass} h-full hover:brightness-110 transition-all relative group`; block.style.width=`${percentage}%`; // Tooltip const tooltip=document.createElement('div'); tooltip.className="absolute bottom-full mb-2 left-1/2 -translate-x-1/2 bg-black/90 text-white text-xs p-2 rounded hidden group-hover:block whitespace-nowrap z-50 border border-white/10"; tooltip.innerText=`${name}: ${formatBytes(size)} (${percentage.toFixed(1)}%)`; block.appendChild(tooltip); container.appendChild(block); // Legend Item const legendItem=document.createElement('div'); legendItem.className="flex items-center gap-1.5"; legendItem.innerHTML=` <div class="w-3 h-3 rounded-full ${colorClass}"></div><span class="font-medium text-slate-300">${name}</span><span class="text-slate-500">(${formatBytes(size)})</span>`; legend.appendChild(legendItem);});} // Initialize Drag & Drop setupDragAndDrop(); // Run Init init(); console.log("Jim-G Collision Finder v4 Initialized"); </script></body></html>